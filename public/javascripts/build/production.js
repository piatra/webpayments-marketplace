define("message",[],function(){var e={show:function(t){var n=$("<span/>").addClass("close-handler").html("&times;").on("click",e.remove),r=$("<p/>").addClass("message").html(e.create(t)).append(n).appendTo(t.appendTo);return r},create:function(e){var t=$("<a/>").attr("href",e.href).text(e.message);return e.newTab&&t.attr("target","_blank"),t},remove:function(e){e.preventDefault(),$(this).parents(".message").fadeOut()}};return e}),define("modal",[],function(){var e={show:function(t){e.showOverlay(),$modal=$("<div/>").addClass("modal"),t.form&&($modal=e.createForm(t.form,$modal));var n=$("<span/>").addClass("close-handler").html("&times;").on("click",e.remove);$modal.append(n),$("<h2/>").text(t.title).appendTo($modal),t.components.forEach(function(e){var t=$("<"+e.tag+"/>");for(var n in e){if(n=="tag")continue;t.attr(n,e[n])}$modal.append(t)}),t.form?$modal.parent().appendTo("body"):$modal.appendTo("body")},showOverlay:function(){$("<div/>").addClass("modal-overlay").appendTo("body").fadeIn()},remove:function(e){e.preventDefault(),$(this).parents(".modal").fadeOut("fast"),$(".modal-overlay").fadeOut("slow")},createForm:function(e,t){return $("<form/>").attr("method","POST").attr("action",e).appendTo(t)}};return e}),define("event-login",["message","modal"],function(e,t){var n={handleLogin:function(e){console.log(e),e.status=="okay"?($(".js-handler--login").text(e.email),e.registered=="false"&&n.showPayswarmRegistration(e)):(alert("Login failed!"),console.log(e))},showPayswarmRegistration:function(t){console.log(t),$.post("/payswarm/register/",{publicKey:t.publicKey}).success(function(t){var r=e.show({message:"You need to register with a payswarm authority",href:t,appendTo:".messages",newTab:!0});n.completePayswarmRegistration(r)})},completePayswarmRegistration:function(e){$("a",e).on("click",function(){t.show({title:"Complete Payswarm registration",components:[{tag:"textarea",placeholder:"Paste the content here",name:"payswarm_response"},{tag:"input",type:"hidden",name:"email",value:$(".js-handler--login").text()},{tag:"input",type:"submit",value:"Register","class":"button--main"}],form:"/payswarm/complete"})})}};return n}),define("event-handlers",["message","event-login","modal"],function(e,t,n){var r={assertion:function(e){$.post("/auth/verify",{assertion:e}).success(t.handleLogin).fail(function(e){console.log("fail",e)})}},i={init:function(){navigator.id.watch({onlogin:function(e){r.assertion(e)},onlogout:function(){console.log("logout")},loggedInUser:undefined}),$(".js-handler--login").on("click",function(){navigator.id.request()})}};return i}),define("app",["event-handlers"],function(e){var t={init:function(){}};return t}),require(["app"],function(e){e.init()}),define("main",function(){});